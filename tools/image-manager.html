<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <meta name="theme-color" content="#0a0f0c">
  <meta name="robots" content="noindex, nofollow">
  <title>Image Manager | dtslib</title>
  <style>
    :root {
      --bg: #0a0f0c;
      --bg-elevated: #141f18;
      --bg-card: #1a2b20;
      --gold: #f0c850;
      --gold-dim: rgba(240,200,80,.2);
      --text: #ffffff;
      --text-secondary: rgba(255,255,255,.85);
      --text-muted: rgba(255,255,255,.6);
      --border: rgba(255,255,255,.15);
      --success: #5fd068;
      --error: #ff5555;
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      line-height: 1.5;
    }

    .container { max-width: 500px; margin: 0 auto; }

    .header {
      text-align: center;
      padding: 20px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }

    .header h1 { font-size: 24px; margin-bottom: 4px; }
    .header p { font-size: 13px; color: var(--text-muted); }

    .config-section {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
    }

    .config-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .config-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .config-label {
      font-size: 12px;
      color: var(--text-secondary);
      min-width: 60px;
    }

    .config-input {
      flex: 1;
      padding: 10px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 13px;
      color: var(--text);
    }

    .config-input:focus { outline: none; border-color: var(--gold); }

    .config-status {
      font-size: 16px;
      width: 24px;
      text-align: center;
    }

    .upload-section {
      background: var(--bg-elevated);
      border: 2px dashed var(--border);
      border-radius: var(--radius-lg);
      padding: 40px 20px;
      text-align: center;
      margin-bottom: 16px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .upload-section:hover { border-color: var(--gold); }
    .upload-section.dragover { border-color: var(--gold); background: var(--gold-dim); }

    .upload-icon { font-size: 48px; margin-bottom: 12px; opacity: 0.6; }
    .upload-text { font-size: 14px; color: var(--text-secondary); margin-bottom: 8px; }
    .upload-hint { font-size: 11px; color: var(--text-muted); }

    .upload-input { display: none; }

    .preview-section {
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
      display: none;
    }

    .preview-section.show { display: block; }

    .preview-image {
      width: 100%;
      max-height: 200px;
      object-fit: contain;
      border-radius: var(--radius-sm);
      margin-bottom: 12px;
    }

    .preview-info {
      font-size: 12px;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .folder-select {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .folder-btn {
      padding: 8px 14px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      font-size: 12px;
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
    }

    .folder-btn:hover { border-color: var(--gold); }
    .folder-btn.active { background: var(--gold); color: var(--bg); border-color: var(--gold); }

    .action-btn {
      width: 100%;
      padding: 14px;
      background: var(--gold);
      border: none;
      border-radius: var(--radius-md);
      font-size: 15px;
      font-weight: 600;
      color: var(--bg);
      cursor: pointer;
      transition: all 0.2s;
    }

    .action-btn:hover { transform: scale(1.02); }
    .action-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .result-section {
      background: var(--bg-elevated);
      border: 1px solid var(--success);
      border-radius: var(--radius-md);
      padding: 16px;
      margin-bottom: 16px;
      display: none;
    }

    .result-section.show { display: block; }

    .result-title {
      font-size: 12px;
      font-weight: 600;
      color: var(--success);
      margin-bottom: 12px;
    }

    .url-box {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 12px;
      font-size: 11px;
      font-family: monospace;
      color: var(--text-secondary);
      word-break: break-all;
      margin-bottom: 8px;
    }

    .copy-btn {
      width: 100%;
      padding: 10px;
      background: var(--success);
      border: none;
      border-radius: var(--radius-sm);
      font-size: 13px;
      font-weight: 600;
      color: var(--bg);
      cursor: pointer;
    }

    .gallery-section {
      margin-top: 24px;
    }

    .gallery-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .gallery-item {
      aspect-ratio: 1;
      background: var(--bg-elevated);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      overflow: hidden;
      cursor: pointer;
      transition: all 0.2s;
    }

    .gallery-item:hover { border-color: var(--gold); }

    .gallery-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .gallery-empty {
      grid-column: 1 / -1;
      text-align: center;
      padding: 40px;
      color: var(--text-muted);
      font-size: 13px;
    }

    .back-link {
      display: block;
      text-align: center;
      padding: 16px;
      color: var(--text-muted);
      font-size: 13px;
      margin-top: 20px;
    }

    .back-link:hover { color: var(--gold); }

    .toast {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--bg-elevated);
      border: 1px solid var(--gold);
      padding: 12px 24px;
      border-radius: 100px;
      font-size: 13px;
      color: var(--gold);
      opacity: 0;
      transition: all 0.3s;
      z-index: 1000;
    }

    .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

    .loading { opacity: 0.6; pointer-events: none; }
  </style>
</head>
<body>

<div class="container">
  <header class="header">
    <h1>ğŸ“· Image Manager</h1>
    <p>GitHub ë¯¸ë””ì–´ ë ˆí¬ì— ì´ë¯¸ì§€ ì—…ë¡œë“œ</p>
  </header>

  <!-- Config -->
  <div class="config-section">
    <div class="config-title">GitHub ì„¤ì •</div>
    <div class="config-row">
      <span class="config-label">GitHub</span>
      <input type="text" class="config-input" id="githubId" placeholder="username">
      <span class="config-status" id="statusGithub">ğŸ”’</span>
    </div>
    <div class="config-row">
      <span class="config-label">ë¯¸ë””ì–´</span>
      <input type="text" class="config-input" id="mediaRepo" placeholder="my-media">
      <span class="config-status" id="statusMedia">ğŸ”’</span>
    </div>
    <div class="config-row">
      <span class="config-label">PAT</span>
      <input type="password" class="config-input" id="pat" placeholder="ghp_xxxx">
      <span class="config-status" id="statusPat">ğŸ”’</span>
    </div>
    <button class="action-btn" onclick="saveConfig()" style="margin-top:8px;background:var(--bg-card);color:var(--text);border:1px solid var(--border);">ğŸ’¾ ì„¤ì • ì €ì¥</button>
  </div>

  <!-- Upload -->
  <div class="upload-section" id="uploadSection" onclick="document.getElementById('fileInput').click()">
    <div class="upload-icon">ğŸ“·</div>
    <div class="upload-text">íƒ­í•˜ì—¬ ì´ë¯¸ì§€ ì„ íƒ</div>
    <div class="upload-hint">ë˜ëŠ” íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸</div>
    <input type="file" class="upload-input" id="fileInput" accept="image/*" onchange="handleFileSelect(event)">
  </div>

  <!-- Preview -->
  <div class="preview-section" id="previewSection">
    <img class="preview-image" id="previewImage" src="" alt="Preview">
    <div class="preview-info" id="previewInfo"></div>
    <div class="folder-select">
      <button class="folder-btn active" onclick="selectFolder(this, 'images')">images</button>
      <button class="folder-btn" onclick="selectFolder(this, 'icons')">icons</button>
      <button class="folder-btn" onclick="selectFolder(this, 'photos')">photos</button>
      <button class="folder-btn" onclick="selectFolder(this, 'banners')">banners</button>
    </div>
    <button class="action-btn" id="uploadBtn" onclick="uploadImage()">ğŸš€ GitHubì— ì—…ë¡œë“œ</button>
  </div>

  <!-- Result -->
  <div class="result-section" id="resultSection">
    <div class="result-title">âœ… ì—…ë¡œë“œ ì™„ë£Œ</div>
    <div class="url-box" id="cdnUrl"></div>
    <button class="copy-btn" onclick="copyUrl()">ğŸ“‹ CDN URL ë³µì‚¬</button>
  </div>

  <!-- Gallery -->
  <div class="gallery-section">
    <div class="gallery-title">
      <span>ğŸ“ ì—…ë¡œë“œëœ ì´ë¯¸ì§€</span>
      <button class="folder-btn" onclick="loadGallery()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
    </div>
    <div class="gallery-grid" id="galleryGrid">
      <div class="gallery-empty">ì„¤ì • ì €ì¥ í›„ ì´ë¯¸ì§€ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
    </div>
  </div>

  <a href="../" class="back-link">â† ë©”ì¸ìœ¼ë¡œ</a>
</div>

<div class="toast" id="toast"></div>

<script>
const CONFIG_KEY = 'dtslib_repo_config';
let selectedFile = null;
let selectedFolder = 'images';

// Load config
document.addEventListener('DOMContentLoaded', () => {
  const saved = localStorage.getItem(CONFIG_KEY);
  if (saved) {
    const config = JSON.parse(saved);
    document.getElementById('githubId').value = config.githubId || '';
    document.getElementById('mediaRepo').value = config.mediaRepo || '';
    document.getElementById('pat').value = config.pat || '';
    updateStatus(config);
    loadGallery();
  }
});

function saveConfig() {
  const config = {
    githubId: document.getElementById('githubId').value.trim(),
    mediaRepo: document.getElementById('mediaRepo').value.trim(),
    pat: document.getElementById('pat').value.trim()
  };

  // Merge with existing config
  const existing = localStorage.getItem(CONFIG_KEY);
  if (existing) {
    const old = JSON.parse(existing);
    Object.assign(old, config);
    localStorage.setItem(CONFIG_KEY, JSON.stringify(old));
  } else {
    localStorage.setItem(CONFIG_KEY, JSON.stringify(config));
  }

  updateStatus(config);
  showToast('ì„¤ì • ì €ì¥ë¨');
  loadGallery();
}

function updateStatus(config) {
  document.getElementById('statusGithub').textContent = config.githubId ? 'ğŸ”“' : 'ğŸ”’';
  document.getElementById('statusMedia').textContent = config.mediaRepo ? 'ğŸ”“' : 'ğŸ”’';
  document.getElementById('statusPat').textContent = config.pat ? 'ğŸ”“' : 'ğŸ”’';
}

// File handling
function handleFileSelect(event) {
  const file = event.target.files[0];
  if (!file) return;

  selectedFile = file;

  const reader = new FileReader();
  reader.onload = (e) => {
    document.getElementById('previewImage').src = e.target.result;
    document.getElementById('previewInfo').textContent = `${file.name} (${(file.size / 1024).toFixed(1)} KB)`;
    document.getElementById('previewSection').classList.add('show');
    document.getElementById('resultSection').classList.remove('show');
  };
  reader.readAsDataURL(file);
}

function selectFolder(btn, folder) {
  document.querySelectorAll('.folder-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  selectedFolder = folder;
}

// Upload
async function uploadImage() {
  if (!selectedFile) {
    showToast('íŒŒì¼ì„ ì„ íƒí•˜ì„¸ìš”');
    return;
  }

  const config = JSON.parse(localStorage.getItem(CONFIG_KEY) || '{}');
  if (!config.githubId || !config.mediaRepo || !config.pat) {
    showToast('GitHub ì„¤ì •ì„ ì™„ë£Œí•˜ì„¸ìš”');
    return;
  }

  const btn = document.getElementById('uploadBtn');
  btn.disabled = true;
  btn.textContent = 'â³ ì—…ë¡œë“œ ì¤‘...';

  try {
    const content = await fileToBase64(selectedFile);
    const fileName = `${Date.now()}_${selectedFile.name.replace(/[^a-zA-Z0-9._-]/g, '_')}`;
    const path = `${selectedFolder}/${fileName}`;

    const response = await fetch(`https://api.github.com/repos/${config.githubId}/${config.mediaRepo}/contents/${path}`, {
      method: 'PUT',
      headers: {
        'Authorization': `token ${config.pat}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        message: `Upload ${fileName}`,
        content: content
      })
    });

    if (response.ok) {
      const cdnUrl = `https://cdn.jsdelivr.net/gh/${config.githubId}/${config.mediaRepo}@main/${path}`;
      document.getElementById('cdnUrl').textContent = cdnUrl;
      document.getElementById('resultSection').classList.add('show');
      showToast('ì—…ë¡œë“œ ì™„ë£Œ!');
      loadGallery();
    } else {
      const error = await response.json();
      showToast('ì—…ë¡œë“œ ì‹¤íŒ¨: ' + (error.message || 'ì˜¤ë¥˜'));
    }
  } catch (e) {
    showToast('ì˜¤ë¥˜: ' + e.message);
  }

  btn.disabled = false;
  btn.textContent = 'ğŸš€ GitHubì— ì—…ë¡œë“œ';
}

function fileToBase64(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result.split(',')[1];
      resolve(base64);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

function copyUrl() {
  const url = document.getElementById('cdnUrl').textContent;
  navigator.clipboard.writeText(url).then(() => {
    showToast('URL ë³µì‚¬ë¨');
  }).catch(() => {
    // Fallback
    const textarea = document.createElement('textarea');
    textarea.value = url;
    document.body.appendChild(textarea);
    textarea.select();
    document.execCommand('copy');
    document.body.removeChild(textarea);
    showToast('URL ë³µì‚¬ë¨');
  });
}

// Gallery
async function loadGallery() {
  const config = JSON.parse(localStorage.getItem(CONFIG_KEY) || '{}');
  const grid = document.getElementById('galleryGrid');

  if (!config.githubId || !config.mediaRepo) {
    grid.innerHTML = '<div class="gallery-empty">GitHub ì„¤ì •ì„ ì™„ë£Œí•˜ì„¸ìš”</div>';
    return;
  }

  grid.innerHTML = '<div class="gallery-empty">ë¡œë”© ì¤‘...</div>';

  try {
    const response = await fetch(`https://api.github.com/repos/${config.githubId}/${config.mediaRepo}/contents/images`, {
      headers: config.pat ? { 'Authorization': `token ${config.pat}` } : {}
    });

    if (response.ok) {
      const files = await response.json();
      const images = files.filter(f => /\.(jpg|jpeg|png|gif|webp)$/i.test(f.name));

      if (images.length === 0) {
        grid.innerHTML = '<div class="gallery-empty">ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      grid.innerHTML = images.slice(0, 9).map(img => {
        const cdnUrl = `https://cdn.jsdelivr.net/gh/${config.githubId}/${config.mediaRepo}@main/images/${img.name}`;
        return `<div class="gallery-item" onclick="copyImageUrl('${cdnUrl}')"><img src="${cdnUrl}" alt="${img.name}" loading="lazy"></div>`;
      }).join('');
    } else {
      grid.innerHTML = '<div class="gallery-empty">images í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
    }
  } catch (e) {
    grid.innerHTML = '<div class="gallery-empty">ë¡œë”© ì‹¤íŒ¨</div>';
  }
}

function copyImageUrl(url) {
  navigator.clipboard.writeText(url).then(() => {
    showToast('ì´ë¯¸ì§€ URL ë³µì‚¬ë¨');
  });
}

function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2000);
}

// Drag & Drop
const uploadSection = document.getElementById('uploadSection');
uploadSection.addEventListener('dragover', (e) => {
  e.preventDefault();
  uploadSection.classList.add('dragover');
});
uploadSection.addEventListener('dragleave', () => {
  uploadSection.classList.remove('dragover');
});
uploadSection.addEventListener('drop', (e) => {
  e.preventDefault();
  uploadSection.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file && file.type.startsWith('image/')) {
    document.getElementById('fileInput').files = e.dataTransfer.files;
    handleFileSelect({ target: { files: [file] } });
  }
});
</script>

</body>
</html>
